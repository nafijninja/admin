<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Firebase Admin Panel</title>
</head>
<body>
    <h1>Firebase Admin Panel</h1>

    <!-- Input Fields -->
    <label for="enterKey">Enter Key:</label>
    <input type="text" id="enterKey" placeholder="Enter Key">
    <br><br>
    <label for="enterValue">Enter Value:</label>
    <input type="text" id="enterValue" placeholder="Enter Value">
    <br><br>
    <label for="uploadImage">Upload Image:</label>
    <input type="file" id="uploadImage" accept="image/*">
    <br><br>
    <button id="updateButton">Update Data</button>
    <button id="deleteButton">Delete Data</button>
    <br><br>
    <p id="statusMessage" style="font-weight: bold;"></p>

    <!-- Firebase SDK Compatibility Mode -->
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-storage-compat.js"></script>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyA8u8_i2rD6HEvU8Pi4CaZC916ny63ec3I",
            authDomain: "website-demo-24.firebaseapp.com",
            databaseURL: "https://website-demo-24-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "website-demo-24",
            storageBucket: "website-demo-24.firebasestorage.app",
            messagingSenderId: "346117554665",
            appId: "1:346117554665:web:0c1536c7176517c8a4cb78",
            measurementId: "G-1GSKL8WVQJ"
        };

        // Initialize Firebase
        const app = firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        const storage = firebase.storage();

        // Status Message Element
        const statusMessage = document.getElementById("statusMessage");

        // Upload Image and Get URL Function
        function uploadImage(file) {
            return new Promise((resolve, reject) => {
                const storageRef = storage.ref('images/' + file.name);
                const uploadTask = storageRef.put(file);

                uploadTask.on('state_changed', 
                    function(snapshot) {
                        // You can show upload progress here if needed
                    }, 
                    function(error) {
                        reject("Error uploading image: " + error.message);
                    }, 
                    function() {
                        uploadTask.snapshot.ref.getDownloadURL().then(function(downloadURL) {
                            resolve(downloadURL);
                        });
                    }
                );
            });
        }

        // Update Data with Image Functionality
        document.getElementById("updateButton").addEventListener("click", async function() {
            const key = document.getElementById("enterKey").value;
            const value = document.getElementById("enterValue").value;
            const imageFile = document.getElementById("uploadImage").files[0];

            if (key && value) {
                try {
                    let imageUrl = null;

                    if (imageFile) {
                        imageUrl = await uploadImage(imageFile);
                    }

                    // Check if imageUrl is null and use the value from input if necessary
                    const reference = database.ref("data/" + key);
                    await reference.set({
                        value: value,
                        imageUrl: imageUrl || "No image uploaded"
                    });

                    // Show status
                    statusMessage.textContent = "✅ Data updated successfully!";
                    statusMessage.style.color = "green";
                } catch (error) {
                    statusMessage.textContent = "❌ " + error;
                    statusMessage.style.color = "red";
                }
            } else {
                statusMessage.textContent = "⚠️ Please enter both key and value.";
                statusMessage.style.color = "orange";
            }
        });

        // Delete Data Functionality
        document.getElementById("deleteButton").addEventListener("click", function() {
            const key = document.getElementById("enterKey").value;

            if (key) {
                const reference = database.ref("data/" + key);
                reference.remove()
                    .then(() => {
                        statusMessage.textContent = "✅ Data deleted successfully!";
                        statusMessage.style.color = "green";
                    })
                    .catch((error) => {
                        statusMessage.textContent = "❌ Error deleting data: " + error.message;
                        statusMessage.style.color = "red";
                    });
            } else {
                statusMessage.textContent = "⚠️ Please enter a key to delete.";
                statusMessage.style.color = "orange";
            }
        });
    </script>

</body>
</html>
